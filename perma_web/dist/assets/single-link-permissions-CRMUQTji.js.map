{"version":3,"file":"single-link-permissions-CRMUQTji.js","sources":["../../static/js/single-link-permissions.module.js"],"sourcesContent":["var SingleLinkModule = require('./single-link.module');\nvar DOMHelpers = require('./helpers/dom.helpers.js');\nvar APIModule = require('./helpers/api.module.js');\nvar Helpers = require('./helpers/general.helpers.js');\nvar LinkHelpers = require('./helpers/link.helpers.js');\n\n\nvar updateBtnID = '#updatePermalink',\n    cancelBtnID = '#cancelUpdatePermalink';\n\nfunction init () {\n  // Hide query parameter from the special Safari redirect\n  if (window.location.href.indexOf('safari=1') > -1) {\n    history.replaceState({}, \"\", window.location.href.replace(/\\??safari=1/, ''));\n  }\n\n  DOMHelpers.toggleBtnDisable(updateBtnID, true);\n  DOMHelpers.toggleBtnDisable(cancelBtnID, true);\n\n  setupEventHandlers();\n}\n\nfunction setupEventHandlers () {\n  $(\".edit-link\").click( function () {\n    $(SingleLinkModule.detailsButton).click();\n    return false;\n  });\n\n  $(\"button.darchive\").click( function(){\n    handleDarchiving($(this));\n    return false;\n  });\n\n  $(\"input:file\").change(function (){\n    var fileName = $(this).val();\n    var disableStatus = fileName ? false : true;\n    DOMHelpers.toggleBtnDisable(cancelBtnID,disableStatus);\n    DOMHelpers.toggleBtnDisable(updateBtnID,disableStatus);\n  });\n\n  $(\"button:reset\").click(function(){\n    DOMHelpers.toggleBtnDisable(cancelBtnID, true);\n    DOMHelpers.toggleBtnDisable(updateBtnID, true);\n  });\n\n  $('#archive_upload_form')\n    .submit(function(e) {\n      e.preventDefault();\n      submitFile();\n    });\n  var inputValues = {};\n  $('#collapse-details')\n    .find('input')\n    .on('input propertychange change', function () {\n      var inputarea = $(this);\n      var name = inputarea.attr(\"name\");\n      if (name == \"file\") return;\n      if (inputarea.val() == inputValues[name]) return;\n      inputValues[name] = inputarea.val();\n      var statusElement = inputarea.parents().find(`.${name}-save-status`);\n\n      LinkHelpers.saveInput(archive.guid, inputarea, statusElement, name, ()=>{\n        setTimeout(function() {\n          $(statusElement).html('');\n        }, 1000);\n      });\n    });\n}\n\nfunction submitFile () {\n  DOMHelpers.toggleBtnDisable(updateBtnID,true);\n  DOMHelpers.toggleBtnDisable(cancelBtnID, true);\n  var url = \"/archives/\"+archive.guid+\"/\";\n  var data = {};\n  data['file'] = $('#archive_upload_form').find('.file')[0].files[0];\n\n  var requestArgs = {\n    contentType: false,\n    processData: false\n  };\n  if (window.FormData) {\n    Helpers.sendFormData(\"PATCH\", url, data, requestArgs)\n    .done(function(data){\n      location=location;\n    });\n  } else {\n    $('#upload-error').text('Your browser version does not allow for this action. Please use a more modern browser.');\n  }\n}\n\nfunction handleDarchiving (context) {\n  var $this = context;\n  if (!$this.hasClass('disabled')){\n    var prev_text = $this.text(),\n      currently_private = prev_text.indexOf('Public') > -1,\n      private_reason = currently_private ? null : $('select[name=\"private_reason\"]').val() || 'user';\n\n    $this.addClass('disabled');\n    $this.text('Updating ...');\n\n    APIModule.request('PATCH', '/archives/' + archive.guid + '/', {is_private: !currently_private, private_reason: private_reason}, {\n      success: function(){\n        window.location.reload(true);\n      },\n      error: function(jqXHR){\n        $this.removeClass('disabled');\n        $this.text(prev_text);\n      }\n    });\n  }\n}\n\ninit();\n"],"names":["SingleLinkModule","DOMHelpers","APIModule","Helpers","LinkHelpers","updateBtnID","cancelBtnID","init","setupEventHandlers","handleDarchiving","fileName","disableStatus","submitFile","inputValues","inputarea","name","statusElement","url","data","requestArgs","context","$this","prev_text","currently_private","private_reason","jqXHR"],"mappings":"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"}